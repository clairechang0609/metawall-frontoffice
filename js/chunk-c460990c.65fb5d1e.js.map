{"version":3,"sources":["webpack:///./src/views/AddPost.vue?5c52","webpack:///./src/views/AddPost.vue","webpack:///./src/views/AddPost.vue?7233"],"names":["class","_createElementVNode","for","role","aria-hidden","_createElementBlock","_hoisted_2","_hoisted_6","rows","id","placeholder","$data","content","$event","_hoisted_8","type","accept","ref","onChange","$options","src","_toDisplayString","disabled","onClick","name","data","info","image","imagePreview","errorMessage","isLoading","computed","mapState","token","state","mounted","methods","getPreviewFile","input","this","$refs","URL","createObjectURL","files","uploadFile","Promise","resolve","reject","FormData","append","DataTransfer","config","method","url","process","headers","authorization","$http","then","response","error","message","uploadPost","$router","push","submitPost","__exports__","render"],"mappings":"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","file":"js/chunk-c460990c.65fb5d1e.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./AddPost.vue?vue&type=style&index=0&id=d18a63f2&lang=scss&scoped=true\"","<template>\n\t<div class=\"post-wrap\">\n\t\t<h3 class=\"title py-3 border bg-white text-center mb-4\">張貼動態</h3>\n\t\t<div class=\"rounded-card card\">\n\t\t\t<div class=\"card-body p-4\">\n\t\t\t\t<div class=\"mb-3\">\n\t\t\t\t\t<label for=\"content\" class=\"form-label\">貼文內容</label>\n\t\t\t\t\t<textarea class=\"form-control rounded-0\" rows=\"3\" id=\"content\" placeholder=\"輸入您的貼文內容\"\n\t\t\t\t\t\tv-model=\"info.content\"></textarea>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mb-3\">\n\t\t\t\t\t<label for=\"upload-file\" class=\"btn form-label bg-black text-white shadow-none py-1 mb-0\">上傳圖片</label>\n\t\t\t\t\t<input class=\"form-control d-none\" type=\"file\" id=\"upload-file\" accept=\"image/png, image/jpeg\"\n\t\t\t\t\t\tref=\"upload-file\" @change=\"getPreviewFile()\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"image-wrap border rounded overflow-hidden\" v-show=\"imagePreview\">\n\t\t\t\t\t<img :src=\"imagePreview\" class=\"w-100\">\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"errorMessage\" class=\"text-danger text-center d-block mt-3\">\n\t\t\t\t\t<small>{{ errorMessage }}</small>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"submit-btn-wrap mx-auto\">\n\t\t\t\t\t<button type=\"button\" class=\"btn btn-secondary w-100 mt-3\" :disabled=\"!info.content || isLoading\"\n\t\t\t\t\t\t@click=\"submitPost()\">\n\t\t\t\t\t\t<span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\" v-if=\"isLoading\"></span>\n\t\t\t\t\t\t送出貼文\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n\n<script>\nimport { mapState } from 'vuex';\n// const ws = new WebSocket('wss://peaceful-citadel-43202.herokuapp.com/websockets');\n\nexport default {\n\tname: 'AddPost',\n\tdata() {\n\t\treturn {\n\t\t\tinfo: {\n\t\t\t\tcontent: '', // 貼文內容\n\t\t\t\timage: ''\n\t\t\t},\n\t\t\timagePreview: '', // 圖片預覽\n\t\t\terrorMessage: '', // 錯誤訊息\n\t\t\tisLoading: false\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapState({\n\t\t\ttoken: state => state.token\n\t\t})\n\t},\n\tmounted() {\n\t\t// ws.onopen = () => console.log('WebSocket 服務已連接');\n\t\t// ws.onclose = () => console.log('WebSocket 伺服器關閉');\n\t},\n\tmethods: {\n\t\tgetPreviewFile() { // 預覽圖片\n\t\t\tconst input = this.$refs['upload-file'];\n\t\t\tthis.imagePreview = URL.createObjectURL(input.files[0]);\n\t\t},\n\t\tuploadFile() { // 上傳檔案到 aws s3\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tconst input = this.$refs['upload-file'];\n\t\t\t\tconst data = new FormData();\n\t\t\t\tdata.append('image', input.files[0]);\n\t\t\t\tinput.files = new DataTransfer().files; // 清空 input，避免重複選同一檔案無法觸發 change 事件\n\n\t\t\t\tconst config = {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\turl: `${process.env.VUE_APP_APIPATH}/api/v1/file`,\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tauthorization: `Bearer ${this.token}`\n\t\t\t\t\t},\n\t\t\t\t\tdata: data\n\t\t\t\t};\n\t\t\t\tthis.$http(config)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tthis.info.image = response.data.data;\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\treject(error.response.data.message);\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tuploadPost() {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tconst config = {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\turl: `${process.env.VUE_APP_APIPATH}/api/v1/post`,\n\t\t\t\t\theaders: {\n\t\t\t\t\t\tauthorization: `Bearer ${this.token}`\n\t\t\t\t\t},\n\t\t\t\t\tdata: this.info\n\t\t\t\t};\n\t\t\t\tthis.$http(config)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tthis.$router.push({ name: 'Home' });\n\t\t\t\t\t\tresolve(response.data.data);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\treject(error.response.data.message);\n\t\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tasync submitPost() {\n\t\t\ttry {\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tif (this.imagePreview) {\n\t\t\t\t\tawait this.uploadFile(); // 先上傳圖片\n\t\t\t\t}\n\t\t\t\tawait this.uploadPost(); // 接著上傳貼文\n\t\t\t\t// const response = await this.uploadPost(); // 接著上傳貼文\n\t\t\t\t// await ws.send(JSON.stringify(response)); // 更新貼文\n\t\t\t\tthis.isLoading = false;\n\t\t\t} catch (error) {\n\t\t\t\tthis.errorMessage = error;\n\t\t\t\tthis.isLoading = false;\n\t\t\t}\n\t\t}\n\t}\n};\n</script>\n\n<style lang=\"scss\" scoped>\n\t.post-wrap {\n\t\t.title {\n\t\t\tbox-shadow: -5px 5px 0 -2px white, -5px 5px 0 0px $black;\n\t\t}\n\t\t.submit-btn-wrap {\n\t\t\twidth: 320px;\n\t\t}\n\t}\n</style>\n","import { render } from \"./AddPost.vue?vue&type=template&id=d18a63f2&scoped=true\"\nimport script from \"./AddPost.vue?vue&type=script&lang=js\"\nexport * from \"./AddPost.vue?vue&type=script&lang=js\"\n\nimport \"./AddPost.vue?vue&type=style&index=0&id=d18a63f2&lang=scss&scoped=true\"\n\nimport exportComponent from \"/home/runner/work/metawall-frontoffice/metawall-frontoffice/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-d18a63f2\"]])\n\nexport default __exports__"],"sourceRoot":""}